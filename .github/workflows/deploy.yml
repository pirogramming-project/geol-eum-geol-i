name: Django Auto Deploy

on:
  push:
    branches:
      - main  # ðŸš€ main ë¸Œëžœì¹˜ì— pushë  ë•Œ ì‹¤í–‰ë¨

jobs:
  deploy:
    runs-on: ubuntu-latest  # GitHub Actionsì—ì„œ ì‚¬ìš©í•  OS í™˜ê²½
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3  # GitHub ì €ìž¥ì†Œì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜´

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.8"  # Python ë²„ì „ ì„¤ì •

      - name: Install Dependencies
        run: pip install fabric  # Fabric ì„¤ì¹˜

      - name: Deploy with Fabric
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}  # GitHub Secretsì—ì„œ SSH í‚¤ ê°€ì ¸ì˜¤ê¸°
        run: |
          echo "$SSH_PRIVATE_KEY" > private_key.pem  # ë¹„ë°€í‚¤ ì €ìž¥
          chmod 600 private_key.pem  # SSH í‚¤ ê¶Œí•œ ì„¤ì •
          ssh -o StrictHostKeyChecking=no -i private_key.pem root@101.79.11.121 "cd ~/home/ubuntu/geol-eum-geol-i && python deploy.py"
