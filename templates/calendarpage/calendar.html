<!DOCTYPE html>
{% load static %}
<html>
  <head>
    <title>Calendar</title>
    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/root.css' %}">
    <link rel="stylesheet" href="{% static 'css/calendar/calendar.css' %}">
  </head>
  <body>
    <div class="calendar-page-header">
      <div class="calendar-page-header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="47" height="57" viewBox="0 0 47 57" fill="none">
          <path d="M36.4381 26.8837V40.0532C36.4381 41.8312 34.8251 43.2793 32.8327 43.2793H26.9761V31.3566C26.9761 30.2037 26.0426 29.2702 24.8897 29.2702H21.5498C20.3937 29.2702 19.4635 30.2037 19.4635 31.3566V43.2793H13.6068C11.6227 43.2793 10.0014 41.8312 10.0014 40.0532V26.8837C10.1795 26.7947 23.2174 15.2642 23.2174 15.2642C23.2174 15.2642 36.2552 26.7913 36.4334 26.8837H36.4381ZM40.474 21.4953L24.5612 7.88709C23.7976 7.22408 22.6481 7.22408 21.8927 7.88709L5.96518 21.4953C5.17187 22.1798 5.04816 23.3524 5.6782 24.1672C6.01136 24.6141 6.53582 24.9061 7.10156 24.9605C7.16423 24.9687 7.2368 24.9737 7.29947 24.9737C7.78933 24.9737 8.26598 24.8005 8.63378 24.4838L23.222 12.0067L37.8136 24.4872C38.1847 24.7989 38.6531 24.9721 39.1429 24.9721C39.7894 24.9721 40.393 24.6769 40.7691 24.1738C41.3975 23.3541 41.2721 22.1814 40.4772 21.497L40.474 21.4953Z" fill="#B82132"/>
        </svg>
      </div>
      <div class="calender-title">
        <div class="calender-title-firstword">걸음</div>
        <div class="calender-title-secondword">캘린더</div>
      </div>
      <div class="calendar-introduction">
        멈추지 않을 {{ user.nickname }}님의 걸음을 응원해요!
      </div>
    </div>
    <div class="calendar-container">
      <div class="calendar-header">
        <h2 id="currentMonth"></h2>
      </div>
      <div class="calendar-days">
        <div class="day">일</div>
        <div class="day">월</div>
        <div class="day">화</div>
        <div class="day">수</div>
        <div class="day">목</div>
        <div class="day">금</div>
        <div class="day">토</div>
      </div>
      <div class="calendar-dates" id="calendarDates"></div>
      <div class="calendar-information">
        <div>이달의 걸음: {{ total_distance }} km</div>
        <div>이달의 소비 칼로리: {{ total_calories }} kcal</div>
    </div>
      <div class="calendar-controls">
        <button id="prevBtn">이전 달
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 0C4.48584 0 0 4.48584 0 10C0 15.5142 4.48584 20 10 20C15.5142 20 20 15.5142 20 10C20 4.48584 15.5142 0 10 0ZM15 11H7.41406L8.70703 12.293C9.09766 12.6836 9.09766 13.3164 8.70703 13.707C8.51172 13.9023 8.25586 14 8 14C7.74414 14 7.48828 13.9023 7.29297 13.707L4.29297 10.707C3.90234 10.3164 3.90234 9.68359 4.29297 9.29297L7.29297 6.29297C7.68359 5.90234 8.31641 5.90234 8.70703 6.29297C9.09766 6.68359 9.09766 7.31641 8.70703 7.70703L7.41406 9H15C15.5522 9 16 9.44775 16 10C16 10.5522 15.5522 11 15 11Z" fill="#76453B"/>
            </svg>
        </button>
        <button id="nextBtn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path d="M10 0C15.5142 0 20 4.48584 20 10C20 15.5142 15.5142 20 10 20C4.48584 20 0 15.5142 0 10C0 4.48584 4.48584 0 10 0ZM5 11H12.5859L11.293 12.293C10.9023 12.6836 10.9023 13.3164 11.293 13.707C11.4883 13.9023 11.7441 14 12 14C12.2559 14 12.5117 13.9023 12.707 13.707L15.707 10.707C16.0977 10.3164 16.0977 9.68359 15.707 9.29297L12.707 6.29297C12.3164 5.90234 11.6836 5.90234 11.293 6.29297C10.9023 6.68359 10.9023 7.31641 11.293 7.70703L12.5859 9H5C4.44775 9 4 9.44775 4 10C4 10.5522 4.44775 11 5 11Z" fill="#76453B"/>
          </svg>
          다음 달</button>
      </div>
    </div>
  </body>
  <script>
        const calendarDates = document.getElementById("calendarDates");
        const currentMonthElement = document.getElementById("currentMonth");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        const today = new Date(); // 현재 날짜를 나타내는 Date 객체를 저장한다.
        let currentMonth = today.getMonth();
        /* 현재 월을 나타내는 값을 저장한다. getMonth() 메서드는 0부터 시작하는 월을 반환하므로
        1월이면 0, 2월이면 1을 반환한다. */
        let currentYear = today.getFullYear(); // 변수에 현재 연도를 나타내는 값을 저장한다.

        function renderCalendar() {
        /* renderCalendar 함수는 월별 캘랜더를 생성하고 표시하는 함수이다. */
        const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
        /* firstDayOfMonth 변수에 현재 월의 첫 번째 날짜를 나타내는 Date 객체를 저장한다.
        해당 월의 첫 번째 날짜에 대한 정보를 얻는다. */
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        /* daysInMonth 변수에 현재 월의 총 일 수를 나타내는 값을 저장한다. 
        해당 월이 몇 일까지 있는지 알 수 있다. */
        const startDayOfWeek = firstDayOfMonth.getDay();
        /* 변수에 현재 월의 첫 번째 날짜의 요일을 나타내는 값을 저장한다.
        해당 월의 첫 번째 날짜가 무슨 요일인지 알 수 있다. */
        currentMonthElement.textContent = `${currentYear}년 ${currentMonth + 1}월`;
        // 월을 나타내는 요소에 현재 월과 연도를 설정하여 표시한다.

        calendarDates.innerHTML = ""; // 일자를 표시하는 그리드 컨테이너를 비운다.

        // 빈 날짜(이전 달)
        for (let i = 0; i < startDayOfWeek; i++) {
            const emptyDate = document.createElement("div");
            //  빈 날짜를 나타내는 div 요소를 생성한다.
            emptyDate.classList.add("date", "empty");
            // 생성한 div 요소에 "date"와 "empty" 클래스를 추가한다.
            calendarDates.appendChild(emptyDate);
            // 생성한 빈 날짜 요소를 캘린더 그리드에 추가한다.
        }

        // 현재 달의 날짜
        for (let i = 1; i <= daysInMonth; i++) {
          const dateElement = document.createElement("div");
          dateElement.classList.add("date");
          dateElement.textContent = i;

          // 날짜 형식을 "YYYY-MM-DD"로 변환하여 data-date 속성에 저장(김규일일)
          const formattedDate = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
          dateElement.dataset.date = formattedDate;

          calendarDates.appendChild(dateElement);
        }
        /* 
        1. for 문을 이용하여 현재 월의 총 일 수만큼 반복하여 월의 날짜를 순서대로 표시한다.
        2. const dateElement = document.createElement("div");를 통해 날짜를 나타내는 div 요소를 생성한다.
        3. dateElement.classList.add("date");를 통해 생성한 div 요소에 "date" 클래스를 추가한다.
        4. dateElement.textContent = i;를 통해 해당 날짜 값을 div 요소의 텍스트로 설정한다.
        5. calendarDates.appendChild(dateElement);를 통해 생성한 날짜 요소를 캘린더 그리드에 추가한다.
        */
        }

        renderCalendar();
        // 페이지가 로드되면 renderCalendar 함수를 실행하여 초기 캘린더를 표시한다.

        prevBtn.addEventListener("click", () => {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        renderCalendar();
        });
        /* 
        1. 이전 버튼(prevBtn)을 클릭하면 현재 월을 이전 월로 변경하고, 연도가 바뀌어야 한다면 연도를 변경한다.
        2. 변경된 월과 연도를 바탕으로 renderCalendar 함수를 호출하여 이전 월의 캘린더를 표시한다.
        */

        nextBtn.addEventListener("click", () => {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar();
        });
        /* 
        1. 다음 버튼(nextBtn)을 클릭하면 현재 월을 다음 월로 변경하고, 연도가 바뀌어야 한다면 연도를 변경한다.
        2. 변경된 월과 연도를 바탕으로 renderCalendar 함수를 호출하여 다음 월의 캘린더를 표시한다.
        */
  </script>

  <script>
    {% comment %} 
    캘린더 날짜 클릭시 detail로 이동(김규일)
    {% endcomment %}
    document.addEventListener("DOMContentLoaded", function () {
      const dates = document.getElementById("calendarDates");
  
      dates.addEventListener("click", function (event) {
          if (event.target.classList.contains("date")) {
              const selectedDate = event.target.dataset.date; // 올바르게 data-date 가져오기
              console.log("선택된 날짜:", selectedDate); // 디버깅 로그 출력
  
              if (!selectedDate) {
                  alert("날짜 정보가 올바르게 전달되지 않았습니다.");
                  return;
              }
  
              // 기록 존재 여부 확인 후 페이지 이동
              fetch(`/record/check/${selectedDate}/`)
                  .then(response => response.json())
                  .then(data => {
                      if (data.has_record) {
                          window.location.href = `/record/history/${selectedDate}/`;
                      } else {
                          alert("이 날짜에는 기록이 없습니다.");
                      }
                  })
                  .catch(error => console.error("에러 발생:", error));
          }
      });
  });
  </script>
</html>